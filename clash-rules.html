<div class="content-container" data-v-a3c25e27=""><!--[--><!--]-->
    <div data-v-0bc40447="" data-v-a3c25e27="" class="VPDocOutlineDropdown"><button data-v-0bc40447="" class="">On this
            page <svg data-v-0bc40447="" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false"
                viewBox="0 0 24 24" class="icon">
                <path
                    d="M9,19c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l5.3-5.3L8.3,6.7c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l6,6c0.4,0.4,0.4,1,0,1.4l-6,6C9.5,18.9,9.3,19,9,19z">
                </path>
            </svg></button><!----></div>
    <main class="main" data-v-a3c25e27="">
        <div style="position:relative;" class="vp-doc _configuration_rules" data-v-a3c25e27="">
            <div>
                <h1 id="rules-规则" tabindex="-1">Rules 规则 <a class="header-anchor" href="#rules-规则"
                        aria-label="Permalink to &quot;Rules 规则&quot;">​</a></h1>
                <p>在<a href="/configuration/getting-started.html">快速入手</a>中, 我们介绍了Clash中基于规则的匹配的基本知识. 在本章中, 我们将介绍最新版本的
                    Clash 中所有可用的规则类型.</p>
                <div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span>
                    <pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#babed8;"># 类型,参数,策略(,no-resolve)</span></span>
    <span class="line"><span style="color:#babed8;">TYPE,ARGUMENT,POLICY(,no-resolve)</span></span></code></pre>
                </div>
                <p><code>no-resolve</code> 选项是可选的, 它用于跳过规则的 DNS 解析. 当您想要使用
                    <code>GEOIP</code>、<code>IP-CIDR</code>、<code>IP-CIDR6</code>、<code>SCRIPT</code> 规则, 但又不想立即将域名解析为
                    IP 地址时, 这个选项就很有用了.</p>
                <nav class="table-of-contents">
                    <ul>
                        <li><a href="#策略">策略</a></li>
                        <li><a href="#规则类型">规则类型</a>
                            <ul>
                                <li><a href="#domain-域名">DOMAIN 域名</a></li>
                                <li><a href="#domain-suffix-域名后缀">DOMAIN-SUFFIX 域名后缀</a></li>
                                <li><a href="#domain-keyword-域名关键字">DOMAIN-KEYWORD 域名关键字</a></li>
                                <li><a href="#geoip-ip地理位置-国家代码">GEOIP IP地理位置 (国家代码)</a></li>
                                <li><a href="#ip-cidr-ipv4地址段">IP-CIDR IPv4地址段</a></li>
                                <li><a href="#ip-cidr6-ipv6地址段">IP-CIDR6 IPv6地址段</a></li>
                                <li><a href="#src-ip-cidr-源ip段地址">SRC-IP-CIDR 源IP段地址</a></li>
                                <li><a href="#src-port-源端口">SRC-PORT 源端口</a></li>
                                <li><a href="#dst-port-目标端口">DST-PORT 目标端口</a></li>
                                <li><a href="#process-name-源进程名">PROCESS-NAME 源进程名</a></li>
                                <li><a href="#process-path-源进程路径">PROCESS-PATH 源进程路径</a></li>
                                <li><a href="#ipset-ip集">IPSET IP集</a></li>
                                <li><a href="#rule-set-规则集">RULE-SET 规则集</a></li>
                                <li><a href="#script-脚本">SCRIPT 脚本</a></li>
                                <li><a href="#match-全匹配">MATCH 全匹配</a></li>
                            </ul>
                        </li>
                    </ul>
                </nav>
                <h2 id="策略" tabindex="-1">策略 <a class="header-anchor" href="#策略"
                        aria-label="Permalink to &quot;策略&quot;">​</a></h2>
                <p>目前有四种策略类型, 其中:</p>
                <ul>
                    <li>DIRECT: 通过 <code>interface-name</code> 直接连接到目标 (不查找系统路由表)</li>
                    <li>REJECT: 丢弃数据包</li>
                    <li>Proxy: 将数据包路由到指定的代理服务器</li>
                    <li>Proxy Group: 将数据包路由到指定的策略组</li>
                </ul>
                <h2 id="规则类型" tabindex="-1">规则类型 <a class="header-anchor" href="#规则类型"
                        aria-label="Permalink to &quot;规则类型&quot;">​</a></h2>
                <p>以下部分介绍了每种规则类型及其使用方法:</p>
                <h3 id="domain-域名" tabindex="-1">DOMAIN 域名 <a class="header-anchor" href="#domain-域名"
                        aria-label="Permalink to &quot;DOMAIN 域名&quot;">​</a></h3>
                <p><code>DOMAIN,www.google.com,policy</code> 将 <code>www.google.com</code> 路由到 <code>policy</code>.</p>
                <h3 id="domain-suffix-域名后缀" tabindex="-1">DOMAIN-SUFFIX 域名后缀 <a class="header-anchor"
                        href="#domain-suffix-域名后缀" aria-label="Permalink to &quot;DOMAIN-SUFFIX 域名后缀&quot;">​</a></h3>
                <p><code>DOMAIN-SUFFIX,youtube.com,policy</code> 将任何以 <code>youtube.com</code> 结尾的域名路由到
                    <code>policy</code>.</p>
                <p>在这种情况下, <code>www.youtube.com</code> 和 <code>foo.bar.youtube.com</code> 都将路由到 <code>policy</code>.
                </p>
                <h3 id="domain-keyword-域名关键字" tabindex="-1">DOMAIN-KEYWORD 域名关键字 <a class="header-anchor"
                        href="#domain-keyword-域名关键字" aria-label="Permalink to &quot;DOMAIN-KEYWORD 域名关键字&quot;">​</a>
                </h3>
                <p><code>DOMAIN-KEYWORD,google,policy</code> 将任何包含 <code>google</code> 关键字的域名路由到 <code>policy</code>.
                </p>
                <p>在这种情况下, <code>www.google.com</code> 或 <code>googleapis.com</code> 都将路由到 <code>policy</code>.</p>
                <h3 id="geoip-ip地理位置-国家代码" tabindex="-1">GEOIP IP地理位置 (国家代码) <a class="header-anchor"
                        href="#geoip-ip地理位置-国家代码" aria-label="Permalink to &quot;GEOIP IP地理位置 (国家代码)&quot;">​</a></h3>
                <p>GEOIP 规则用于根据数据包的目标 IP 地址的<strong>国家代码</strong>路由数据包. Clash 使用 <a
                        href="https://dev.maxmind.com/geoip/geoip2/geolite2/" target="_blank" rel="noreferrer">MaxMind
                        GeoLite2</a> 数据库来实现这一功能.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>使用这种规则时, Clash 将域名解析为 IP 地址, 然后查找 IP 地址的国家代码. 如果要跳过 DNS 解析, 请使用 <code>no-resolve</code> 选项.</p>
                </div>
                <p><code>GEOIP,CN,policy</code> 将任何目标 IP 地址为中国的数据包路由到 <code>policy</code>.</p>
                <h3 id="ip-cidr-ipv4地址段" tabindex="-1">IP-CIDR IPv4地址段 <a class="header-anchor" href="#ip-cidr-ipv4地址段"
                        aria-label="Permalink to &quot;IP-CIDR IPv4地址段&quot;">​</a></h3>
                <p>IP-CIDR 规则用于根据数据包的<strong>目标 IPv4 地址</strong>路由数据包.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>使用这种规则时, Clash 将域名解析为 IPv4 地址. 如果要跳过 DNS 解析, 请使用 <code>no-resolve</code> 选项.</p>
                </div>
                <p><code>IP-CIDR,127.0.0.0/8,DIRECT</code> 将任何目标 IP 地址为 <code>127.0.0.0/8</code> 的数据包路由到
                    <code>DIRECT</code>.</p>
                <h3 id="ip-cidr6-ipv6地址段" tabindex="-1">IP-CIDR6 IPv6地址段 <a class="header-anchor"
                        href="#ip-cidr6-ipv6地址段" aria-label="Permalink to &quot;IP-CIDR6 IPv6地址段&quot;">​</a></h3>
                <p>IP-CIDR6 规则用于根据数据包的<strong>目标 IPv6 地址</strong>路由数据包.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>使用这种规则时, Clash 将域名解析为 IPv6 地址. 如果要跳过 DNS 解析, 请使用 <code>no-resolve</code> 选项.</p>
                </div>
                <p><code>IP-CIDR6,2620:0:2d0:200::7/32,policy</code> 将任何目标 IP 地址为 <code>2620:0:2d0:200::7/32</code>
                    的数据包路由到 <code>policy</code>.</p>
                <h3 id="src-ip-cidr-源ip段地址" tabindex="-1">SRC-IP-CIDR 源IP段地址 <a class="header-anchor"
                        href="#src-ip-cidr-源ip段地址" aria-label="Permalink to &quot;SRC-IP-CIDR 源IP段地址&quot;">​</a></h3>
                <p>SRC-IP-CIDR 规则用于根据数据包的<strong>源 IPv4 地址</strong>路由数据包.</p>
                <p><code>SRC-IP-CIDR,192.168.1.201/32,DIRECT</code> 将任何源 IP 地址为 <code>192.168.1.201/32</code> 的数据包路由到
                    <code>DIRECT</code>.</p>
                <h3 id="src-port-源端口" tabindex="-1">SRC-PORT 源端口 <a class="header-anchor" href="#src-port-源端口"
                        aria-label="Permalink to &quot;SRC-PORT 源端口&quot;">​</a></h3>
                <p>SRC-PORT 规则用于根据数据包的<strong>源端口</strong>路由数据包.</p>
                <p><code>SRC-PORT,80,policy</code> 将任何源端口为 <code>80</code> 的数据包路由到 <code>policy</code>.</p>
                <h3 id="dst-port-目标端口" tabindex="-1">DST-PORT 目标端口 <a class="header-anchor" href="#dst-port-目标端口"
                        aria-label="Permalink to &quot;DST-PORT 目标端口&quot;">​</a></h3>
                <p>DST-PORT 规则用于根据数据包的<strong>目标端口</strong>路由数据包.</p>
                <p><code>DST-PORT,80,policy</code> 将任何目标端口为 <code>80</code> 的数据包路由到 <code>policy</code>.</p>
                <h3 id="process-name-源进程名" tabindex="-1">PROCESS-NAME 源进程名 <a class="header-anchor"
                        href="#process-name-源进程名" aria-label="Permalink to &quot;PROCESS-NAME 源进程名&quot;">​</a></h3>
                <p>PROCESS-NAME 规则用于根据发送数据包的进程名称路由数据包.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>目前, 仅支持 macOS、Linux、FreeBSD 和 Windows.</p>
                </div>
                <p><code>PROCESS-NAME,nc,DIRECT</code> 将任何来自进程 <code>nc</code> 的数据包路由到 <code>DIRECT</code>.</p>
                <h3 id="process-path-源进程路径" tabindex="-1">PROCESS-PATH 源进程路径 <a class="header-anchor"
                        href="#process-path-源进程路径" aria-label="Permalink to &quot;PROCESS-PATH 源进程路径&quot;">​</a></h3>
                <p>PROCESS-PATH 规则用于根据发送数据包的进程路径路由数据包.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>目前, 仅支持 macOS、Linux、FreeBSD 和 Windows.</p>
                </div>
                <p><code>PROCESS-PATH,/usr/local/bin/nc,DIRECT</code> 将任何来自路径为 <code>/usr/local/bin/nc</code> 的进程的数据包路由到
                    <code>DIRECT</code>.</p>
                <h3 id="ipset-ip集" tabindex="-1">IPSET IP集 <a class="header-anchor" href="#ipset-ip集"
                        aria-label="Permalink to &quot;IPSET IP集&quot;">​</a></h3>
                <p>IPSET 规则用于根据 IP 集匹配并路由数据包. 根据 <a href="https://ipset.netfilter.org/" target="_blank"
                        rel="noreferrer">IPSET 的官方网站</a> 的介绍:</p>
                <blockquote>
                    <p>IP 集是 Linux 内核中的一个框架, 可以通过 ipset 程序进行管理. 根据类型, IP 集可以存储 IP 地址、网络、 (TCP/UDP) 端口号、MAC
                        地址、接口名称或它们以某种方式的组合, 以确保在集合中匹配条目时具有闪电般的速度.</p>
                </blockquote>
                <p>因此, 此功能仅在 Linux 上工作, 并且需要安装 <code>ipset</code>.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>使用此规则时, Clash 将解析域名以获取 IP 地址, 然后查找 IP 地址是否在 IP 集中. 如果要跳过 DNS 解析, 请使用 <code>no-resolve</code> 选项.
                    </p>
                </div>
                <p><code>IPSET,chnroute,policy</code> 将任何目标 IP 地址在 IP 集 <code>chnroute</code> 中的数据包路由到
                    <code>policy</code>.</p>
                <h3 id="rule-set-规则集" tabindex="-1">RULE-SET 规则集 <a class="header-anchor" href="#rule-set-规则集"
                        aria-label="Permalink to &quot;RULE-SET 规则集&quot;">​</a></h3>
                <div class="info custom-block">
                    <p class="custom-block-title">INFO</p>
                    <p>此功能仅在 <a href="/premium/introduction.html">Premium 版本</a> 中可用.</p>
                </div>
                <p>RULE-SET 规则用于根据 <a href="/premium/rule-providers.html" class="link-instanted" target="_self">Rule
                        Providers 规则集</a> 的结果路由数据包. 当 Clash 使用此规则时, 它会从指定的 Rule Providers 规则集中加载规则, 然后将数据包与规则进行匹配.
                    如果数据包与任何规则匹配, 则将数据包路由到指定的策略, 否则跳过此规则.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>使用 RULE-SET 时, 当规则集的类型为 IPCIDR , Clash 将解析域名以获取 IP 地址. 如果要跳过 DNS 解析, 请使用 <code>no-resolve</code>
                        选项.</p>
                </div>
                <p><code>RULE-SET,my-rule-provider,DIRECT</code> 从 <code>my-rule-provider</code> 加载所有规则</p>
                <h3 id="script-脚本" tabindex="-1">SCRIPT 脚本 <a class="header-anchor" href="#script-脚本"
                        aria-label="Permalink to &quot;SCRIPT 脚本&quot;">​</a></h3>
                <div class="info custom-block">
                    <p class="custom-block-title">INFO</p>
                    <p>此功能仅在 <a href="/premium/introduction.html">Premium 版本</a> 中可用.</p>
                </div>
                <p>SCRIPT 规则用于根据脚本的结果路由数据包. 当 Clash 使用此规则时, 它会执行指定的脚本, 然后将数据包路由到脚本的输出.</p>
                <div class="warning custom-block">
                    <p class="custom-block-title">WARNING</p>
                    <p>使用 SCRIPT 时, Clash 将解析域名以获取 IP 地址. 如果要跳过 DNS 解析, 请使用 <code>no-resolve</code> 选项.</p>
                </div>
                <p><code>SCRIPT,script-path,DIRECT</code> 将数据包路由到脚本 <code>script-path</code> 的输出.</p>
                <h3 id="match-全匹配" tabindex="-1">MATCH 全匹配 <a class="header-anchor" href="#match-全匹配"
                        aria-label="Permalink to &quot;MATCH 全匹配&quot;">​</a></h3>
                <p>MATCH 规则用于路由剩余的数据包. 该规则是<strong>必需</strong>的, 通常用作最后一条规则.</p>
                <p><code>MATCH,policy</code> 将剩余的数据包路由到 <code>policy</code>.</p>
            </div>
        </div>
    </main>
    <footer class="VPDocFooter" data-v-a3c25e27="" data-v-5774f702=""><!--[--><!--]--><!---->
        <nav class="prev-next" data-v-5774f702="">
            <div class="pager" data-v-5774f702=""><a class="pager-link prev" href="/configuration/outbound.html"
                    data-v-5774f702=""><span class="desc" data-v-5774f702="">Previous page</span><span class="title"
                        data-v-5774f702="">Outbound 出站</span></a></div>
            <div class="pager" data-v-5774f702=""><a class="pager-link next" href="/configuration/dns.html"
                    data-v-5774f702=""><span class="desc" data-v-5774f702="">Next page</span><span class="title"
                        data-v-5774f702="">Clash DNS</span></a></div>
        </nav>
    </footer><!--[--><!--]-->
</div>